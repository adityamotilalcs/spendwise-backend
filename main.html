<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpendWise - Expense Manager</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* =========================================
          Â 1. USER'S LOGIN PAGE STYLES
           ========================================= */

        body.login-mode {
            font-family: sans-serif;
            background: rgb(30, 198, 228);
            /* NOTE: background-image requires a valid file path. Actual file found: 'rupee 5.jpg.jpg' */
            /* Use the exact filename (or rename the file to remove the extra extension/space) */
            background-image: url("images/rupee 5.jpg.jpg");
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .login-wrapper .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 350px;
            text-align: center;
        }

        .app-title {
            font-family: 'Dancing Script', cursive;
            font-size: 3em;
            color: rgb(63, 176, 146);
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(-50px);
            animation: title-load 1.5s ease-out forwards;
        }

        @keyframes title-load {
            0% { opacity: 0; transform: translateY(-50px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .form-container input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box; 
            transition: border-color 0.3s ease;
        }

        .form-container input:focus { border-color: #2193b0; outline: none; }

        .submit-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 20px;
            background-color: #2193b0;
            color: white;
            transition: background-color 0.4s ease, transform 0.2s ease; 
        }

        .submit-btn:hover {
            background-color: #6dd5ed;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 147, 176, 0.4);
        }

        .hidden { display: none; }

        .form-container a { color: #2193b0; text-decoration: none; transition: color 0.3s ease; }
        .form-container a:hover { color: #6dd5ed; }
        .form-container p { margin-top: 15px; color: #666; font-size: 0.9rem; }


        /* =========================================
          Â 2. DASHBOARD / APP STYLES - MODIFIED
           ========================================= */
        
        body.app-mode {
            background-color: #f4f7f6;
            color: #2d3436;
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            display: block;
        }

        :root {
            --primary: #6c5ce7;
            --secondary: #00b894;
            --danger: #ff7675;
            --card-bg: #ffffff;
            --text-muted: #636e72;
            --border: #dfe6e9;
            /* Define a variable for the sidebar width for easy maintenance */
            --sidebar-width: 250px; 
        }

        /* Dark theme variable overrides for better contrast */
        :root[data-theme="dark"] {
            --text-muted: #bfc9d0;
            --border: #485460;
            --card-bg: #2d3436;
            --primary: #a29bfe;
        }

        [data-theme="dark"] body.app-mode { background-color: #1e272e; color: #dfe6e9; }
        [data-theme="dark"] .card, [data-theme="dark"] .sidebar { background-color: #2d3436; border-color: #485460; color: #dfe6e9; }

        /* Fix: Set display to flex in JS, ensure it's hidden when not logged in */
        #app-wrapper { display: none; min-height: 100vh; } 

        .sidebar {
            width: var(--sidebar-width); background-color: var(--card-bg); padding: 20px;
            border-right: 1px solid var(--border); display: flex; flex-direction: column;
            position: fixed; left: 0; top: 0; height: 100vh; box-sizing: border-box; overflow: auto;
            transition: width 0.3s ease; /* Add transition for smoother mobile toggle */
            z-index: 100; /* Ensure sidebar is on top */
        }

        .logo-area {
            font-family: 'Dancing Script', cursive; font-size: 2rem; color: var(--primary);
            margin-bottom: 40px; display: flex; align-items: center; gap: 10px;
        }

        .nav-item {
            padding: 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer;
            color: var(--text-muted); display: flex; align-items: center; gap: 10px;
        }
        .nav-item:hover, .nav-item.active { background-color: rgba(108, 92, 231, 0.1); color: var(--primary); }

        /* Fix: Use calc to ensure main content is correctly offset from the fixed sidebar */
        /* Ensure main content is fully offset from the fixed sidebar so nothing is hidden behind it */
        .main-content { margin-left: calc(var(--sidebar-width) + 20px); flex: 1; padding: 30px; width: calc(100% - var(--sidebar-width) - 20px); }

        /* Keep header content clearly visible and prevent accidental overlap */
        .main-content header { position: relative; z-index: 1; }
        .main-content header h2 { margin: 0; word-break: break-word; }

        .card {
            background-color: var(--card-bg); padding: 25px; border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid var(--border);
        }

        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .stat-card .value { font-size: 1.8rem; font-weight: bold; }
        
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        
        .transaction-item {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card-bg); padding: 15px; border-radius: 12px;
            margin-bottom: 10px; border: 1px solid var(--border);
        }

        .transaction-item small { color: var(--text-muted); }
        .muted { color: var(--text-muted); }
        .delete-btn { border: none; background: none; color: var(--text-muted); cursor: pointer; font-size: 0.8rem; }

        .app-input, .app-select {
            width: 100%; padding: 10px; margin-bottom: 15px;
            border: 1px solid var(--border); border-radius: 8px; display: block;
        }

        .view-section { display: none; }
        .view-section.active { display: block; }

        .bar-container { margin-bottom: 15px; }
        .bar-label { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .progress-bg { height: 10px; background: #dfe6e9; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 1s; }

        /* Fix: Added explicit width/height to make the dark mode button a perfect circle */
        .btn-area button:last-child {
            width: 40px; 
            height: 40px;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            :root {
                --sidebar-width: 70px; /* Collapse sidebar on mobile */
            }
            .sidebar { width: var(--sidebar-width); padding: 10px; }
            /* Hide all text elements in the sidebar on mobile */
            .sidebar span, .logo-area span, .tip-box { display: none; }
            /* Update main content margin and width for the collapsed sidebar */
            .main-content { margin-left: calc(var(--sidebar-width) + 10px); padding: 15px; width: calc(100% - var(--sidebar-width) - 10px); }
            .content-grid { grid-template-columns: 1fr; }
        }
        
        @media print {
            .sidebar, .add-form, .btn-area { display: none !important; }
            .main-content { margin: 0; }
        }
       
       

        
    </style>
</head>
<body class="login-mode">

    <!-- =========================================
         1. LOGIN SECTION
         ========================================= -->
    <div class="login-wrapper" id="login-section">
        <div class="container">
            <h1 class="app-title">SpendWise</h1>

            <!-- Sign In Form -->
            <div class="form-container" id="signin-container">
                <h2>Sign In</h2>
                <!-- Added ID "form-login" and removed inline onsubmit -->
                <form id="form-login">
                    <input type="email" id="login-email" placeholder="Email">
                    <input type="password" id="login-pass" placeholder="Password">
                    <button type="submit" class="submit-btn">Sign In</button>
                </form>
                <p>Don't have an account? <a href="#" id="show-register">Register</a></p>
            </div>

            <!-- Register Form -->
            <div class="form-container hidden" id="register-container">
                <h2>Register</h2>
                <!-- Added ID "form-register" and removed inline onsubmit -->
                <form id="form-register">
                    <input type="text" id="reg-name" placeholder="Full Name">
                    <input type="email" id="reg-email" placeholder="Email">
                    <input type="password" id="reg-pass" placeholder="Password">
                    <button type="submit" class="submit-btn">Register</button>
                </form>
                <p>Already have an account? <a href="#" id="show-signin">Sign In</a></p>
            </div>
        </div>
    </div>

    <!-- =========================================
         2. DASHBOARD SECTION
         ========================================= -->
    <div id="app-wrapper" style="display: none;">
        <nav class="sidebar">
            <div class="logo-area">
                <i data-lucide="wallet"></i>
                <span>SpendWise</span>
            </div>
            <div class="nav-item active" onclick="switchTab('dashboard')">
                <i data-lucide="layout-dashboard"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" onclick="switchTab('reports')">
                <i data-lucide="pie-chart"></i>
                <span>Reports</span>
            </div>
            <div style="margin-top: auto; background: #ffeaa7; padding: 15px; border-radius: 10px; color: #333; font-size: 0.85rem;" class="tip-box">
                <strong>ðŸ’¡ Tip:</strong> <span id="tip-text">Save more!</span>
            </div>
            <div class="nav-item" style="margin-top: 10px; color: var(--danger);" onclick="logout()">
                <i data-lucide="log-out"></i>
                <span>Logout</span>
            </div>
        </nav>

        <main class="main-content">
            <header style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                <div>
                    <h2 id="greeting">Welcome Back</h2>
                    <p style="color: gray;" id="current-date">Date</p>
                </div>
                <div class="btn-area" style="display: flex; gap: 10px;">
                    <button onclick="window.print()" style="padding: 8px 15px; background:white; border:1px solid #ccc; border-radius:8px; cursor:pointer;">
                        Download PDF
                    </button>
                    <button onclick="toggleTheme()" style="padding: 8px; border-radius: 50%; border: 1px solid #ccc; background: white; cursor:pointer;">
                        ðŸŒ™
                    </button>
                </div>
            </header>

            <section id="dashboard-view" class="view-section active">
                <div class="stats-grid">
                    <div class="card stat-card">
                        <h3>Total Balance</h3>
                        <div class="value" id="total-balance">â‚¹0.00</div>
                    </div>
                    <div class="card stat-card">
                        <h3>Income</h3>
                        <div class="value" style="color: #00b894;" id="total-income">â‚¹0.00</div>
                    </div>
                    <div class="card stat-card">
                        <h3>Expenses</h3>
                        <div class="value" style="color: #ff7675;" id="total-expense">â‚¹0.00</div>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="card">
                        <h3>Transactions</h3>
                        <div id="transaction-list" style="margin-top: 20px; max-height: 400px; overflow-y: auto;"></div>
                    </div>
                    <div class="card add-form">
                        <h3>Add New</h3>
                        <form id="form-add-transaction" style="margin-top: 20px;">
                            <label>Description</label>
                            <input type="text" id="t-desc" class="app-input" placeholder="Description (optional)">
                            <label>Amount (â‚¹)</label>
                            <input type="number" id="t-amount" class="app-input" step="0.01">
                            <label>Date</label>
                            <input type="date" id="t-date" class="app-input">
                            <label>Type</label>
                            <select id="t-type" class="app-select">
                                <option value="expense">Expense</option>
                                <option value="income">Income</option>
                            </select>
                            <div id="category-group">
                                <label>Category</label>
                                <select id="t-category" class="app-select">
                                    <option value="Food">Food</option>
                                    <option value="Travel">Travel</option>
                                    <option value="Bills">Bills</option>
                                    <option value="Shopping">Shopping</option>
                                    <option value="Others">Others</option>
                                </select>
                            </div>
                            <button type="submit" class="submit-btn" style="margin-top: 5px;">Add</button>
                        </form>
                    </div>
                </div>
            </section>

            <section id="reports-view" class="view-section">
                <div class="card">
                    <h3>Spending Breakdown</h3>
                    <div id="category-bars" style="margin-top: 20px;"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- =========================================
         3. JAVASCRIPT
         ========================================= -->
    <script>
        // --- Variables ---
        let transactions = JSON.parse(localStorage.getItem('spendwise_transactions')) || [];
        let currentUser = JSON.parse(localStorage.getItem('spendwise_user'));
        let theme = localStorage.getItem('spendwise_theme') || 'light';
        const tips = [
            "Use the 50/30/20 rule: 50% Needs, 30% Wants, 20% Savings.",
            "Avoid impulse buying: Wait 24 hours before big purchases.",
            "Track small expensesâ€”they add up quickly!",
            "Cancel unused subscriptions to save â‚¹500+ a month."
        ];

        // --- Initialization ---
        window.onload = function() {
            try { lucide.createIcons(); } catch(e) {}
            applyTheme(theme);
            rotateTip();
            
            // 1. Setup Toggle Links
            document.getElementById('show-register').onclick = function(e) {
                e.preventDefault();
                document.getElementById('signin-container').classList.add('hidden');
                document.getElementById('register-container').classList.remove('hidden');
            };
            document.getElementById('show-signin').onclick = function(e) {
                e.preventDefault();
                document.getElementById('register-container').classList.add('hidden');
                document.getElementById('signin-container').classList.remove('hidden');
            };

            // 2. Setup Forms (Explicitly connection)
            document.getElementById('form-login').addEventListener('submit', performLogin);
            document.getElementById('form-register').addEventListener('submit', performRegister);
            document.getElementById('form-add-transaction').addEventListener('submit', addTransaction);

            // 3. Defaults
            document.getElementById('t-date').valueAsDate = new Date();
            // Ensure category visibility matches the current type initially
            if (document.getElementById('t-type')) {
                document.getElementById('t-type').addEventListener('change', toggleCategoryInput);
                // call once to initialize
                toggleCategoryInput();
            }
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').innerText = new Date().toLocaleDateString('en-IN', options);

            // 4. Check Login State
            if (currentUser && currentUser.isLoggedIn) {
                showDashboard();
            } else {
                showLogin();
            }
        };

        // --- Login / Register Logic ---
        function performRegister(e) {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;

            if(!name || !email || !pass) {
                alert("Please fill in all fields to register.");
                return;
            }

            const userData = { name, email, password: pass, isLoggedIn: true };
            localStorage.setItem('spendwise_user', JSON.stringify(userData));
            
            currentUser = userData;
            alert("Registration Successful!");
            showDashboard();
        }

        function performLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;

            if(!email || !pass) {
                alert("Please enter both email and password.");
                return;
            }
            
            let storedUser = JSON.parse(localStorage.getItem('spendwise_user'));

            if (storedUser && storedUser.email === email && storedUser.password === pass) {
                storedUser.isLoggedIn = true;
                localStorage.setItem('spendwise_user', JSON.stringify(storedUser));
                currentUser = storedUser;
                showDashboard();
            } else if (storedUser && storedUser.email === email) {
                alert("Incorrect Password");
            } else {
                alert("User not found. Please Register first.");
            }
        }

        function logout() {
            if (currentUser) {
                currentUser.isLoggedIn = false;
                localStorage.setItem('spendwise_user', JSON.stringify(currentUser));
            }
            showLogin();
        }

        // --- View Switching ---
        function showDashboard() {
            document.body.classList.remove('login-mode');
            document.body.classList.add('app-mode');
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'flex';
            // Safely set greeting, fall back to 'User' if name is missing
            const name = (currentUser && currentUser.name) ? currentUser.name : 'User';
            const greetingEl = document.getElementById('greeting');
            if (greetingEl) greetingEl.innerText = `Hello, ${name}!`;
            updateUI();
        }

        function showLogin() {
            document.body.classList.remove('app-mode');
            document.body.classList.add('login-mode');
            document.getElementById('app-wrapper').style.display = 'none';
            document.getElementById('login-section').style.display = 'block';
        }

        // --- Transaction Logic ---
        function addTransaction(e) {
            e.preventDefault();
            const descRaw = document.getElementById('t-desc').value;
            const desc = descRaw ? descRaw.trim() : '';
            const amount = document.getElementById('t-amount').value;
            const date = document.getElementById('t-date').value;
            const type = document.getElementById('t-type').value;

            // Description is optional. Only require amount and date. Category only required for expenses.
            if(!amount || !date) {
                alert("Please fill in amount and date for the transaction.");
                return;
            }

            const category = (type === 'expense') ? document.getElementById('t-category').value : 'Income';

            const t = {
                id: Date.now(),
                desc: desc,
                amount: parseFloat(amount),
                date: date,
                type: type,
                category: category
            };
            transactions.push(t);
            localStorage.setItem('spendwise_transactions', JSON.stringify(transactions));
            updateUI();
            
            // Clear inputs
            document.getElementById('t-desc').value = '';
            document.getElementById('t-amount').value = '';
            document.getElementById('t-date').valueAsDate = new Date();
        }

        function toggleCategoryInput() {
            const type = document.getElementById('t-type').value;
            const catGroup = document.getElementById('category-group');
            const catSelect = document.getElementById('t-category');
            if (!catGroup || !catSelect) return;
            if (type === 'income') {
                // hide category for incomes and set a logical category value
                catGroup.style.display = 'none';
                catSelect.value = 'Others';
            } else {
                catGroup.style.display = '';
                // ensure a valid category is selected
                if (!catSelect.value) catSelect.value = 'Others';
            }
        }

        function deleteTransaction(id) {
            if(confirm("Delete this transaction?")) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('spendwise_transactions', JSON.stringify(transactions));
                updateUI();
            }
        }

        function updateUI() {
            const list = document.getElementById('transaction-list');
            const bars = document.getElementById('category-bars');
            list.innerHTML = ""; bars.innerHTML = "";
            
            let inc = 0, exp = 0, cats = {};
            
            const sorted = [...transactions].sort((a,b) => new Date(b.date) - new Date(a.date));
            
            sorted.forEach(t => {
                if (t.type === 'income') inc += t.amount;
                else {
                    exp += t.amount;
                    cats[t.category] = (cats[t.category] || 0) + t.amount;
                }
                
                const div = document.createElement('div');
                div.className = 'transaction-item';
                div.innerHTML = `
                    <div><strong>${t.desc}</strong><br><small class="muted">${t.date} â€¢ ${t.category}</small></div>
                    <div style="text-align:right">
                        <div style="font-weight:bold; color:${t.type==='income'?'#00b894':'#ff7675'}">
                            ${t.type==='income'?'+':'-'}â‚¹${t.amount.toFixed(2)}
                        </div>
                        <button class="delete-btn" onclick="deleteTransaction(${t.id})">Delete</button>
                    </div>
                `;
                list.appendChild(div);
            });

            if(sorted.length === 0) list.innerHTML = "<p class='muted' style='text-align:center'>No transactions yet.</p>";

            document.getElementById('total-balance').innerText = `â‚¹${(inc - exp).toFixed(2)}`;
            document.getElementById('total-income').innerText = `â‚¹${inc.toFixed(2)}`;
            document.getElementById('total-expense').innerText = `â‚¹${exp.toFixed(2)}`;

            for(let c in cats) {
                const pct = (cats[c] / exp) * 100;
                bars.innerHTML += `
                    <div class="bar-container">
                        <div class="bar-label"><span>${c}</span><span>â‚¹${cats[c].toFixed(2)} (${Math.round(pct)}%)</span></div>
                        <div class="progress-bg"><div class="progress-fill" style="width:${pct}%; background:#ff7675"></div></div>
                    </div>
                `;
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.getElementById(`${tab}-view`).classList.add('active');
            
            const navs = document.querySelectorAll('.nav-item');
            navs.forEach(n => n.classList.remove('active'));
            if(tab === 'dashboard') navs[0].classList.add('active');
            if(tab === 'reports') navs[1].classList.add('active');
        }

        function toggleTheme() {
            theme = theme === 'light' ? 'dark' : 'light';
            localStorage.setItem('spendwise_theme', theme);
            applyTheme(theme);
        }

        function applyTheme(t) {
            document.documentElement.setAttribute('data-theme', t);
        }

        function rotateTip() {
            const el = document.getElementById('tip-text');
            if(el) {
                el.innerText = tips[Math.floor(Math.random() * tips.length)];
                setInterval(() => {
                    el.innerText = tips[Math.floor(Math.random() * tips.length)];
                }, 10000);
            }
        }
    </script>
</body>
</html>